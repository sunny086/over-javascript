# 11-企业级项目初始化

## 五 Git 提交控制

### 5.0 配置 husky

执行 commit 之前拦截，检查代码风格，使用工具 husky。该工具提供了三个 git 提交的阶段：

- pre-commit
- commit-msg
- pre-push

使用下列命令自动配置 husky，包括：安装 husky，添加 .husky 文件夹，添加 prepare 脚本等步骤，命令如下：

```txt
npx husky-init && npm install
```

### 5.1 配置提交前强制格式化

设置 git 提交前强制 lint，在.husky/pre-commit 中添加如下内容：

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint
```

### 5.2 配置提交前检查 commit 文本

首先我们放弃直接 `git commit` 而是使用 npm 脚本进行提交，添加 npm 脚本：

```json
{
  "scripts": {
    "commit": "cz"
    /* 其他配置 */
  }
}
```

现在配置实现该命令：

```txt
# 安装 规范commit工具
npm i commitizen -D

# 安装changelog工具，并初始化，且会在package.json 中配置 config 字段，以及添加 prepare 脚本
npx commitizen init cz-conventional-changelog -D --save-exact

# 安装代码提交信息验证工具
npm i @commitlint/config-conventional @commitlint/cli -D
```

根目录创建 commitlint.config.js 配置：

```js
module.exports = {
  extends: ['@commitlint/config-conventional'],
}
```

使用 husky 生成 commit-msg 文件，验证提交信息：

```txt
npx husky add .husky/commit-msg "npx --no-install commitlint --edit $1"
```

此时再使用 `git commit` 就会失败了，只能使用 `npx cz`，或者 npm 脚本 `npm run commit` 提交代码了。
